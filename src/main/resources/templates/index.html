<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="apple-touch-icon" sizes="76x76" th:href="@{/img/apple-icon.png}">
  <link rel="icon" type="image/png" th:href="@{/img/favicon.png}">
  <title>Material Dashboard - Inicio de Sesión</title>

  <!-- Fonts and icons -->
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Inter:300,400,500,600,700,900" />
  <!-- Nucleo Icons -->
  <link th:href="@{/css/nucleo-icons.css}" rel="stylesheet" />
  <link th:href="@{/css/nucleo-svg.css}" rel="stylesheet" />
  <!-- Material Icons -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
  <!-- CSS Files -->
  <link id="pagestyle" th:href="@{/css/material-dashboard.css}" rel="stylesheet" />
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />

  <style>
    .login-card {
      backdrop-filter: blur(10px);
      background-color: rgba(255, 255, 255, 0.9);
      border: none;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.19), 0 6px 6px rgba(0, 0, 0, 0.23);
      overflow: hidden;
    }

    .login-header {
      border-radius: 12px;
      padding: 25px 15px;
      margin-top: -30px;
    }

    .form-floating {
      margin-bottom: 20px;
    }

    .form-floating input {
      height: 60px;
      border-radius: 10px;
      padding-left: 20px;
      border: 1px solid #ddd;
      transition: all 0.3s;
    }

    .form-floating input:focus {
      border-color: #5c35e8;
      box-shadow: 0 0 0 0.25rem rgba(92, 53, 232, 0.25);
    }

    .form-floating label {
      padding-left: 20px;
    }

    .btn-login {
      height: 50px;
      font-size: 16px;
      font-weight: 600;
      letter-spacing: 1px;
      border-radius: 10px;
      text-transform: uppercase;
      transition: all 0.3s;
    }

    .btn-login:hover {
      transform: translateY(-3px);
      box-shadow: 0 7px 14px rgba(50, 50, 93, 0.1), 0 3px 6px rgba(0, 0, 0, 0.08);
    }

    .login-bg {
      background-image: url('https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?auto=format&fit=crop&w=1950&q=80');
      background-size: cover;
      background-position: center;
    }

    .navbar-custom {
      background-color: rgba(255, 255, 255, 0.9) !important;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
    }

    .input-icon {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: #adb5bd;
      z-index: 10;
    }

    .password-toggle {
      cursor: pointer;
    }

    .card-animation {
      animation: fadeIn 1s ease-in-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .brand-name {
      font-weight: 700;
      background: linear-gradient(45deg, #5c35e8, #00c6ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .login-footer {
      background-color: rgba(255, 255, 255, 0.7);
      border-radius: 10px;
      padding: 15px;
      margin-top: 30px;
    }

    .social-login {
      display: flex;
      justify-content: center;
      margin-top: 20px;
      margin-bottom: 20px;
    }

    .social-btn {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 10px;
      color: white;
      transition: all 0.3s;
    }

    .social-btn:hover {
      transform: translateY(-3px);
    }

    .google-btn { background-color: #DB4437; }
    .facebook-btn { background-color: #4267B2; }
    .twitter-btn { background-color: #1DA1F2; }
  </style>
</head>

<body>
<div class="container position-sticky z-index-sticky top-0">
  <div class="row">
    <div class="col-12">
      <!-- Navbar -->
      <nav class="navbar navbar-expand-lg blur border-radius-xl top-0 z-index-3 shadow position-absolute my-3 py-2 start-0 end-0 mx-4 navbar-custom">
        <div class="container-fluid">
          <a class="navbar-brand font-weight-bolder ms-lg-0 ms-3" th:href="@{/dashboard}">
            <span class="brand-name">Material Dashboard</span>
          </a>
          <button class="navbar-toggler shadow-none ms-2" type="button" data-bs-toggle="collapse" data-bs-target="#navigation" aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navigation">
            <ul class="navbar-nav mx-auto">
              <li class="nav-item">
                <a class="nav-link d-flex align-items-center me-2" th:href="@{/dashboard}">
                  <i class="material-symbols-rounded me-1">dashboard</i>
                  Dashboard
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link me-2" th:href="@{/profile}">
                  <i class="material-symbols-rounded me-1">person</i>
                  Perfil
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link me-2" th:href="@{/sign-up}">
                  <i class="material-symbols-rounded me-1">person_add</i>
                  Registro
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link me-2 active" th:href="@{/sign-in}">
                  <i class="material-symbols-rounded me-1">login</i>
                  Iniciar Sesión
                </a>
              </li>
            </ul>
            <ul class="navbar-nav d-lg-flex d-none">
              <li class="nav-item d-flex align-items-center">
                <a class="btn btn-outline-primary btn-sm mb-0 me-2" target="_blank" href="https://www.creative-tim.com/builder">
                  <i class="material-symbols-rounded me-1">construction</i>
                  Builder
                </a>
              </li>
              <li class="nav-item">
                <a href="https://www.creative-tim.com/product/material-dashboard" class="btn btn-sm mb-0 me-1 bg-gradient-primary">
                  <i class="material-symbols-rounded me-1">download</i>
                  Descargar
                </a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
      <!-- End Navbar -->
    </div>
  </div>
</div>

<main class="main-content mt-0">
  <div class="page-header align-items-start min-vh-100 login-bg">
    <span class="mask bg-gradient-primary opacity-4"></span>
    <div class="container my-auto py-5">
      <div class="row">
        <div class="col-lg-5 col-md-8 col-sm-10 mx-auto">
          <div class="card login-card z-index-0 card-animation">
            <div class="card-header p-0 position-relative mt-n4 mx-3 z-index-2">
              <div class="bg-gradient-primary shadow-primary border-radius-lg login-header">
                <h4 class="text-white font-weight-bolder text-center mb-0">Bienvenido de nuevo</h4>
                <p class="text-white text-center opacity-8 mb-0">Ingresa tus credenciales para continuar</p>
              </div>
            </div>
            <div class="card-body p-4">
              <form role="form" class="text-start" id="login-form">
                <div class="position-relative">
                  <div class="form-floating mb-4">
                    <input type="email" class="form-control" id="email-input" placeholder="name@example.com">
                    <label for="email-input">Correo electrónico</label>
                    <div class="input-icon">
                      <i class="fas fa-envelope"></i>
                    </div>
                  </div>
                </div>

                <div class="position-relative">
                  <div class="form-floating">
                    <input type="password" class="form-control" id="password-input" placeholder="Contraseña">
                    <label for="password-input">Contraseña</label>
                    <div class="input-icon password-toggle" id="toggle-password">
                      <i class="fas fa-eye"></i>
                    </div>
                  </div>
                </div>

                <div class="form-check form-switch d-flex align-items-center mt-3">
                  <input class="form-check-input ms-0 me-2" type="checkbox" id="rememberMe">
                  <label class="form-check-label mb-0" for="rememberMe">Recordarme</label>
                  <a href="#" class="text-primary ms-auto">¿Olvidaste tu contraseña?</a>
                </div>

                <div class="text-center">
                  <button type="submit" class="btn bg-gradient-primary w-100 my-4 mb-0 btn-login" id="login-button">
                    <i class="fas fa-sign-in-alt me-2"></i>Iniciar Sesión
                  </button>
                </div>

                <div class="text-center mt-3">
                  <p class="mb-0">¿No tienes una cuenta? <a href="/sign-up" class="text-primary font-weight-bold">Regístrate</a></p>
                </div>
              </form>

              <div class="text-center mt-4">
                <p class="text-secondary">O inicia sesión con</p>
              </div>

              <div class="social-login">
                <a href="#" class="social-btn google-btn"><i class="fab fa-google"></i></a>
                <a href="#" class="social-btn facebook-btn"><i class="fab fa-facebook"></i></a>
                <a href="#" class="social-btn twitter-btn"><i class="fab fa-twitter"></i></a>
              </div>

              <!-- Zona para mostrar mensajes -->
              <div id="login-message" class="text-center mt-3 p-2 rounded" style="display: none;"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer class="footer position-absolute bottom-0 py-3 w-100">
      <div class="container">
        <div class="row align-items-center justify-content-lg-between">
          <div class="col-12 col-md-6 my-auto">
            <div class="copyright text-center text-sm text-white text-lg-start">
              © <script>document.write(new Date().getFullYear())</script>,
              made with <i class="fa fa-heart" aria-hidden="true"></i> by
              <a href="https://www.creative-tim.com" class="font-weight-bold text-white" target="_blank">Creative Tim</a>
              for a better web.
            </div>
          </div>
          <div class="col-12 col-md-6">
            <ul class="nav nav-footer justify-content-center justify-content-lg-end">
              <li class="nav-item">
                <a href="https://www.creative-tim.com" class="nav-link text-white" target="_blank">Creative Tim</a>
              </li>
              <li class="nav-item">
                <a href="https://www.creative-tim.com/presentation" class="nav-link text-white" target="_blank">About Us</a>
              </li>
              <li class="nav-item">
                <a href="https://www.creative-tim.com/blog" class="nav-link text-white" target="_blank">Blog</a>
              </li>
              <li class="nav-item">
                <a href="https://www.creative-tim.com/license" class="nav-link pe-0 text-white" target="_blank">License</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
  </div>
</main>

<script>
  // Toggle password visibility
  document.getElementById("toggle-password").addEventListener("click", function() {
    const passwordInput = document.getElementById("password-input");
    const icon = this.querySelector("i");

    if (passwordInput.type === "password") {
      passwordInput.type = "text";
      icon.classList.remove("fa-eye");
      icon.classList.add("fa-eye-slash");
    } else {
      passwordInput.type = "password";
      icon.classList.remove("fa-eye-slash");
      icon.classList.add("fa-eye");
    }
  });

  // Form submission with animation
  document.getElementById("login-form").addEventListener("submit", async function (event) {
    event.preventDefault();

    const email = document.getElementById("email-input").value.trim();
    const password = document.getElementById("password-input").value.trim();
    const messageDiv = document.getElementById("login-message");
    const loginButton = document.getElementById("login-button");

    // Reset message
    messageDiv.style.display = "none";
    messageDiv.className = "text-center mt-3 p-2 rounded";

    // Simple validation
    if (!email || !password) {
      messageDiv.textContent = "Por favor, completa todos los campos";
      messageDiv.classList.add("bg-danger", "text-white");
      messageDiv.style.display = "block";
      shake(document.querySelector(".login-card"));
      return;
    }

    // Show loading state
    loginButton.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Procesando...';
    loginButton.disabled = true;

    try {
      const response = await fetch("/Logearse", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          username: email,
          password: password
        })
      });

      const data = await response.json();

      if (response.ok && data.status === "ok") {
        messageDiv.textContent = "¡Inicio de sesión exitoso! Redirigiendo...";
        messageDiv.classList.add("bg-success", "text-white");
        messageDiv.style.display = "block";

        // Redirect based on role
        if (data.content === "Admin") {
          setTimeout(() => window.location.href = "/DashboardAdmin", 1000);
        } else {
          setTimeout(() => window.location.href = "/", 1000);
        }
      } else {
        messageDiv.textContent = "Credenciales incorrectas. Por favor, inténtalo de nuevo.";
        messageDiv.classList.add("bg-danger", "text-white");
        messageDiv.style.display = "block";
        shake(document.querySelector(".login-card"));
      }
    } catch (error) {
      console.error("Error en la solicitud:", error);
      messageDiv.textContent = "Error de conexión. Por favor, intenta más tarde.";
      messageDiv.classList.add("bg-danger", "text-white");
      messageDiv.style.display = "block";
    }

    // Reset button state
    loginButton.innerHTML = '<i class="fas fa-sign-in-alt me-2"></i>Iniciar Sesión';
    loginButton.disabled = false;
  });

  // Shake animation for error feedback
  function shake(element) {
    element.classList.add("animate__animated", "animate__shakeX");
    setTimeout(() => {
      element.classList.remove("animate__animated", "animate__shakeX");
    }, 1000);
  }
</script>

<!-- Add animate.css for animations -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />

<!-- Core JS Files -->
<script th:src="@{/js/core/popper.min.js}"></script>
<script th:src="@{/js/core/bootstrap.min.js}"></script>
<script th:src="@{/js/plugins/perfect-scrollbar.min.js}"></script>
<script th:src="@{/js/plugins/smooth-scrollbar.min.js}"></script>
<script>
  var win = navigator.platform.indexOf('Win') > -1;
  if (win && document.querySelector('#sidenav-scrollbar')) {
    var options = {
      damping: '0.5'
    }
    Scrollbar.init(document.querySelector('#sidenav-scrollbar'), options);
  }
</script>
<script th:src="@{/js/material-dashboard.min.js}"></script>
</body>

</html>
